generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
enum SourceType {
  ELECTRICITY
  STATIONARY_FUEL
  MOBILE_FUEL
  FUGITIVE
  PROCESS
}
enum Unit {
  KWH
  M3
  LITRE
  TON
  KG
  KM
}
model Company {
  id        String   @id @default(cuid())
  name      String
  sector    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sources   EmissionSource[]
  records   EmissionRecord[] @relation("CompanyRecords")
  reports   Report[]
}
model EmissionSource {
  id             String      @id @default(cuid())
  company        Company     @relation(fields: [companyId], references: [id])
  companyId      String
  name           String
  type           SourceType
  unit           Unit
  emissionFactor Decimal     @db.Decimal(12,6)
  factorMeta     Json?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  records        EmissionRecord[]
}
model EmissionRecord {
  id         String         @id @default(cuid())
  company    Company        @relation("CompanyRecords", fields: [companyId], references: [id])
  companyId  String
  source     EmissionSource @relation(fields: [sourceId], references: [id])
  sourceId   String
  value      Decimal        @db.Decimal(18,6)
  occurredAt DateTime
  note       String?
  createdAt  DateTime       @default(now())

  @@index([companyId, occurredAt])
  @@index([sourceId, occurredAt])
}
model Report {
  id          String   @id @default(cuid())
  company     Company  @relation(fields: [companyId], references: [id])
  companyId   String
  periodStart DateTime
  periodEnd   DateTime
  totalKg     Decimal  @db.Decimal(18,6)
  scope1Kg    Decimal  @db.Decimal(18,6)
  scope2Kg    Decimal  @db.Decimal(18,6)
  details     Json?
  createdAt   DateTime @default(now())

  @@index([companyId, periodStart, periodEnd])
}
